{"version":3,"sources":["../src/NavLink.tsx"],"sourcesContent":["import Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport React from \"react\";\r\n\r\nexport interface NavLinkProps\r\n  extends Omit<React.AnchorHTMLAttributes<HTMLAnchorElement>, \"href\"> {\r\n  /** Destination URL */\r\n  href: string;\r\n  /** If true, require exact pathname match to mark active (defaults to false) */\r\n  exact?: boolean;\r\n  /** Class applied when the link is active */\r\n  activeClassName?: string;\r\n  /** Additional classes for the link */\r\n  className?: string;\r\n  /** Rendered children (text, icons, etc.) */\r\n  children: React.ReactNode;\r\n  /** If true, external links will open in same tab (defaults to false) */\r\n}\r\n\r\n/**\r\n * Production-ready NavLink component for Next.js (App Router)\r\n *\r\n * Features:\r\n * - Robust active state detection with proper URL normalization\r\n * - Comprehensive external link handling with security defaults\r\n * - Full TypeScript support with proper type safety\r\n * - Accessibility enhancements (ARIA labels, focus management)\r\n * - Performance optimized (memoization, proper link handling)\r\n * - Error boundaries and edge case handling\r\n * - SSR-safe with proper hydration handling\r\n */\r\n\r\n// Constants for better maintainability\r\nconst EXTERNAL_LINK_REGEX = /^(https?:)?\\/\\//;\r\nconst DEFAULT_CLASSES =\r\n  \"inline-flex items-center gap-2 px-3 py-2 rounded-md transition-colors duration-200 focus:outline-none\";\r\nconst DEFAULT_ACTIVE_CLASSES =\r\n  \"text-sky-600 font-semibold bg-sky-50 dark:bg-sky-950/20\";\r\n\r\n// Helper function to normalize paths for comparison\r\nconst normalizePath = (path: string): string => {\r\n  if (!path || path === \"/\") return \"/\";\r\n\r\n  // Remove trailing slashes for consistent comparison\r\n  const normalized = path.endsWith(\"/\") ? path.slice(0, -1) : path;\r\n  return normalized;\r\n};\r\n\r\n// Helper function to determine if link is external\r\nconst isExternalLink = (href: string): boolean => {\r\n  return EXTERNAL_LINK_REGEX.test(href);\r\n};\r\n\r\n// Helper function to extract pathname from external URLs\r\nconst getPathnameFromExternalUrl = (url: string): string => {\r\n  try {\r\n    return new URL(url).pathname;\r\n  } catch {\r\n    return url;\r\n  }\r\n};\r\n\r\nexport default function NavLink({\r\n  href,\r\n  exact = false,\r\n  activeClassName = DEFAULT_ACTIVE_CLASSES,\r\n  className = DEFAULT_CLASSES,\r\n  children,\r\n  ...rest\r\n}: NavLinkProps) {\r\n  const pathname = usePathname();\r\n\r\n  const isExternal = React.useMemo(() => isExternalLink(href), [href]);\r\n\r\n  // Determine active state - handle SSR properly\r\n  const isActive = React.useMemo(() => {\r\n    // During SSR or static generation, pathname is null\r\n    if (!pathname || isExternal) return false;\r\n\r\n    const currentPath = normalizePath(pathname);\r\n    let targetPath: string;\r\n\r\n    if (href.startsWith(\"/\")) {\r\n      targetPath = normalizePath(href);\r\n    } else {\r\n      targetPath = normalizePath(getPathnameFromExternalUrl(href));\r\n    }\r\n\r\n    if (exact) {\r\n      return currentPath === targetPath;\r\n    }\r\n\r\n    // For non-exact matching, check if current path starts with target path\r\n    // and handle the root path specially\r\n    if (targetPath === \"/\") {\r\n      return currentPath === \"/\";\r\n    }\r\n\r\n    return (\r\n      currentPath === targetPath || currentPath.startsWith(targetPath + \"/\")\r\n    );\r\n  }, [pathname, href, exact, isExternal]);\r\n\r\n  // Merge classes efficiently - handle SSR case\r\n  const mergedClassName = React.useMemo(() => {\r\n    const baseClasses = [className];\r\n    // Only apply active class on client side to avoid hydration mismatch\r\n    if (isActive && pathname !== null) {\r\n      baseClasses.push(activeClassName);\r\n    }\r\n    return baseClasses.filter(Boolean).join(\" \").trim();\r\n  }, [className, isActive, activeClassName, pathname]);\r\n\r\n  // FIX: Handle aria-label consistently between server and client\r\n  // Only compute aria-label if explicitly provided, don't derive from children\r\n  const ariaAttributes = React.useMemo(() => {\r\n    const attributes: {\r\n      \"aria-current\"?: \"page\";\r\n      \"aria-label\"?: string;\r\n    } = {\r\n      \"aria-current\": isActive && pathname !== null ? \"page\" : undefined,\r\n    };\r\n\r\n    // Only set aria-label if explicitly provided in props\r\n    // This prevents hydration mismatch from deriving it from children\r\n    if (rest[\"aria-label\"]) {\r\n      attributes[\"aria-label\"] = rest[\"aria-label\"];\r\n    }\r\n\r\n    return attributes;\r\n  }, [isActive, pathname, rest]);\r\n\r\n  return (\r\n    <Link\r\n      href={href}\r\n      className={mergedClassName}\r\n      {...ariaAttributes}\r\n      {...rest}\r\n      prefetch={true}\r\n    >\r\n      {children}\r\n    </Link>\r\n  );\r\n}\r\n\r\n// Optional: Add display name for better debugging\r\nNavLink.displayName = \"NavLink\";\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,UAAU;AACjB,SAAS,mBAAmB;AAC5B,OAAO,WAAW;AAmId;AApGJ,IAAM,sBAAsB;AAC5B,IAAM,kBACJ;AACF,IAAM,yBACJ;AAGF,IAAM,gBAAgB,CAAC,SAAyB;AAC9C,MAAI,CAAC,QAAQ,SAAS,IAAK,QAAO;AAGlC,QAAM,aAAa,KAAK,SAAS,GAAG,IAAI,KAAK,MAAM,GAAG,EAAE,IAAI;AAC5D,SAAO;AACT;AAGA,IAAM,iBAAiB,CAAC,SAA0B;AAChD,SAAO,oBAAoB,KAAK,IAAI;AACtC;AAGA,IAAM,6BAA6B,CAAC,QAAwB;AAC1D,MAAI;AACF,WAAO,IAAI,IAAI,GAAG,EAAE;AAAA,EACtB,SAAQ;AACN,WAAO;AAAA,EACT;AACF;AAEe,SAAR,QAAyB,IAOf;AAPe,eAC9B;AAAA;AAAA,IACA,QAAQ;AAAA,IACR,kBAAkB;AAAA,IAClB,YAAY;AAAA,IACZ;AAAA,EAnEF,IA8DgC,IAM3B,iBAN2B,IAM3B;AAAA,IALH;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAGA,QAAM,WAAW,YAAY;AAE7B,QAAM,aAAa,MAAM,QAAQ,MAAM,eAAe,IAAI,GAAG,CAAC,IAAI,CAAC;AAGnE,QAAM,WAAW,MAAM,QAAQ,MAAM;AAEnC,QAAI,CAAC,YAAY,WAAY,QAAO;AAEpC,UAAM,cAAc,cAAc,QAAQ;AAC1C,QAAI;AAEJ,QAAI,KAAK,WAAW,GAAG,GAAG;AACxB,mBAAa,cAAc,IAAI;AAAA,IACjC,OAAO;AACL,mBAAa,cAAc,2BAA2B,IAAI,CAAC;AAAA,IAC7D;AAEA,QAAI,OAAO;AACT,aAAO,gBAAgB;AAAA,IACzB;AAIA,QAAI,eAAe,KAAK;AACtB,aAAO,gBAAgB;AAAA,IACzB;AAEA,WACE,gBAAgB,cAAc,YAAY,WAAW,aAAa,GAAG;AAAA,EAEzE,GAAG,CAAC,UAAU,MAAM,OAAO,UAAU,CAAC;AAGtC,QAAM,kBAAkB,MAAM,QAAQ,MAAM;AAC1C,UAAM,cAAc,CAAC,SAAS;AAE9B,QAAI,YAAY,aAAa,MAAM;AACjC,kBAAY,KAAK,eAAe;AAAA,IAClC;AACA,WAAO,YAAY,OAAO,OAAO,EAAE,KAAK,GAAG,EAAE,KAAK;AAAA,EACpD,GAAG,CAAC,WAAW,UAAU,iBAAiB,QAAQ,CAAC;AAInD,QAAM,iBAAiB,MAAM,QAAQ,MAAM;AACzC,UAAM,aAGF;AAAA,MACF,gBAAgB,YAAY,aAAa,OAAO,SAAS;AAAA,IAC3D;AAIA,QAAI,KAAK,YAAY,GAAG;AACtB,iBAAW,YAAY,IAAI,KAAK,YAAY;AAAA,IAC9C;AAEA,WAAO;AAAA,EACT,GAAG,CAAC,UAAU,UAAU,IAAI,CAAC;AAE7B,SACE;AAAA,IAAC;AAAA;AAAA,MACC;AAAA,MACA,WAAW;AAAA,OACP,iBACA,OAJL;AAAA,MAKC,UAAU;AAAA,MAET;AAAA;AAAA,EACH;AAEJ;AAGA,QAAQ,cAAc;","names":[]}